# NIP-0003 - QR Library Specification

## Summary

```
    NIP: ?
    Layer: Library
    Title: QR Library Specification
    Author: [AnthonyLaw](https://github.com/AnthonyLaw)
    Co-Author: [Aleix Morgadas](https://github.com/aleixmorgadas)
    Discussions-To: [Nemtech NIP](https://github.com/nemtech/NIP/issues/3)
    Comments-URI: <links to issue page for comments>
    Status: Draft
    Type: Standards Track
    Created: 2018-7-15
    License: MIT
```

## Introduction/Abstract

The purpose of this NIP is to create/define QR library specification standard. Which is allow for generating QRCode for NEM wallet backup, create an invoice for transactions and add new NEM address as the contact list.

The benefit for standardizing QR library specification it helping all different language of SDK to use same QR schema.

## Motivation

In NIS1 there was not a standard, each project used a variation of a QR code schema. It always confuses developer, In addition, it doesn't support mosaics for invoice.

In addition,  user announce transactions without sharing the private key, using only trusted wallets. it will really improve user experience easy to use and increase the security because of you able to do a transaction without sharing the private key across to the network.

## Design Decisions

In Catapult version, it supports cross chain transaction and decentralized asset swap. I foresee in the near future that will be a lot of side chain running on enterprise or business, and they perform cross chain transaction with the NEM mainnet.
To standardize the QR code schema is easy for the developer to apply it. we have many different types of transaction in NEM blockchain.

Base on this QR scheme, we should have an independent library and it should be able to communicate with current existing SDK.

QR library has to generate transaction **output** and **input** for SDK to process the transaction.

## Specification

The table below shows, all the **required** field using in QR code standard parameters.

| **field** | **detail**                              |
| --------- | --------------------------------------- |
| schema         | 1 = add contract \| 2 = transaction \| 3 = import/export account |
| network      |  MIJIN_TEST \| MIJIN \| MAIN_NE T\| TEST_NET       |
| nem_version      | NIS \| Catapult                 |
| type      | TransferTransaction \| AggregateTransaction \| CosignatureTransaction   |
| data      | dataset                                 |

### Add wallet contact
```
{
  "schema": 1,
  "network": "MAIN_NET",
  "nem_version": "Catapult",
  "data": {
    "address": "NA...."
  }
}
```

### Transaction (request Assets / Invoice)
```
{
  "schema": 2,
  "network": "MAIN_NET",
  "nem_version": "Catapult",
  "type": "TransferTransaction",
  "data": {
    "recipient": "NA....",
    "assets": [
      {
        "id": "nem:xem",
        "relativeQuantity": 1
      }
    ],
    "message": {
      "type": 1,
      "payload": "my message"
    }
  }
}
```

### Transaction  (AggregateCompleteTransaction / multiple transaction with different invoice)
```
{
  "schema": 2,
  "network": "MAIN_NET",
  "nem_version": "Catapult",
  "type": "AggregateTransaction",
  "data": {
    "AggregateCompleteTransaction": [
      {
        "recipient": "NA....",
        "assets": [
          {
            "id": "nem:xem",
            "relativeQuantity": 1
          }
        ],
        "message": {
          "type": 1,
          "payload": "my message"
        }
      }
    ]
  }
}
```

### Transaction (Co-sign Transaction)
```
{
  "schema": 2,
  "network": "MAIN_NET",
  "nem_version": "Catapult",
  "type": "CosignatureTransaction",
  "data": {
    "AggregateBondedTransaction": [
      {
        "hash": "6714c22c89c81c656fb771a0492bda7bce6195f7d3ce10fff7cb1b343fdf7671"
      }
    ]
  }
}
```

### Import/Export Account
```
{
  "schema": 3,
  "network": "MAIN_NET",
  "nem_version": "Catapult",
  "data": {
    "encryptedKey": "6714c22c89c81c656....", // vi (32) + encryptedKey (96)
    "salt":"6c9ba0c43cd75b4f323947273db9b6f95aef95695197c0b24a5e10116e3923d1"
  }
}
```

## Implementation

We should create an independent QR library Just like [Apostille-library](https://github.com/luxtagofficial/Apostille-library). it's easy to maintain and update if there is any new QR schema added in.

QR library generates the output and Catapult SDK to do sign transaction and announce.

**Read**
QR code --> QR library Scan --> QR library generate tx output -> SDK sign and announce

**Write**
Define transaction (tx) -> generate QR code

## Backwards compatibility

The previous schemas used in NIS 1 was not well design and lack of support such as a document. In addition, that is a lot of different variables QR schema in different SDK.

The new QR schema design is not compatible with the previous schemas used in NIS 1, because Catapult and NIS 1 have big different structures design itself.

The idea of creating whole new QR schema is to provide a standardizing QR schema and less complexity. Everyone can use this QR schema to build the application or SDK.

## Drawbacks

we should not involve to many inner transaction inside ***AggregateCompleteTransaction***
because maximum character storage capacity for [QRcode](#wiki-qr-code) max is ***4296 Alphanumeric***

we may able to append many inner transactions, it depends on the transaction content. An example that is 0 message and each transaction are attached 1 asset.

Not all types of transaction are covered right now, but here is the list of the transaction type I thinking the most often used:

- [x] TransferTransaction : transfer asset from one to another one address.
- [x] AggregateTransaction 
   - [x] AggregateCompleteTransaction: transfer multiple transactions by signing used a single private key in one transaction.
   - [ ] AggregateBondedTransaction: transfer multiple transactions and involved multiple parties signing in one transaction.
- [x] CosignatureTransaction: sign transaction by transaction hash. 
- [ ] LockFundsTransaction: Announce a lock funds transaction before sending a signed aggregate bonded transaction. This mechanism is required to prevent network spamming.

- [ ] SecretLockTransaction : Use a secret lock transaction to start the cross-chain swap
- [ ] SecretProofTransaction : Use a secret proof transaction to unlock secret lock transactions.

In the future, if there is any new plugin for the catapult, we can just add the new QR schema.

## Alternatives

For QR content, current JSON object format.
the alternatives will be using [URI](https://www.webfx.com/blog/web-design/qr-codes-uri-schemes/) Query base, the benefit of URI it already has some URI protocol such as open default email or open application apps.

For **Add Wallet contact** we actually can think of how to use vCard in our catapult wallet, the advantage of Vcard it can directly save into device contact list. Below is a sample of the vCard params.
```
BEGIN:VCARD
VERSION:4.0
N:Anthony
FN:Law
ORG:NEM
TITLE:NEMber
TEL;TYPE=home,voice;VALUE=uri:tel:NANM......
EMAIL:anthonylaw@example.com
END:VCARD
```

[Scan me here](http://api.qrserver.com/v1/create-qr-code/?color=000000&bgcolor=FFFFFF&data=BEGIN%3AVCARD%0AVERSION%3A4.0%0AN%3AAnthony%0AFN%3ALaw%0AORG%3ANEM%0ATITLE%3ANEMber%0ATEL%3BTYPE%3Dhome%2Cvoice%3BVALUE%3Duri%3Atel%3ANANM......%0AEMAIL%3Aanthonylaw%40example.com%0AEND%3AVCARD&qzone=1&margin=0&size=400x400&ecc=L)
## References

#### QR Service Library on NIS 1
NEM-SDK : [QR object library](https://github.com/QuantumMechanics/NEM-sdk/blob/9e1d881171eb5c32d61791f8078deba962b56692/src/model/objects/qr.js)
NEM-Library: [QRService library](https://github.com/aleixmorgadas/nem-library-ts/blob/fa649c5854287ee122bd635f2c1507d5218a952e/src/services/QRService.ts)
NEM Android : [Android QR Library](https://github.com/NemProject/NEMAndroidApp/tree/9e9db2233b436e8fdbc35161e52e69171c8c7eb3/app/src/main/java/org/nem/nac/models/qr)

#### Catapult SDK 
Typescript/Javascript : [nem2-sdk-typescript-javascript](https://github.com/nemtech/nem2-sdk-typescript-javascript)
Java : [nem2-sdk-java](https://github.com/nemtech/nem2-sdk-java)
more : [NEMTECH Doc](https://nemtech.github.io/sdk/languages.html)


## History

| **Date**     | **Version**   |
| ------------ | ------------- |
| July 15 2018 | Initial Draft |
| Aug 6 2018   | Second Draft  |
